<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">

   <!--=============== FAVICON ===============-->
   <link rel="shortcut icon" href="assets/img/favicon.png" type="image/x-icon">

   <!--=============== REMIXICONS ===============-->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/3.5.0/remixicon.css" crossorigin="">

   <!--=============== CSS ===============-->
   <link rel="stylesheet" href="assets/css/styles.css">

   <title>AstroVision | Tutorial</title>

   <style>
      /* Chatbot Styles */
      .modal {
         display: none;
         position: fixed;
         z-index: 999;
         left: 0;
         top: 0;
         width: 100%;
         height: 100%;
         overflow: auto;
         background: rgba(44, 19, 90, 0.25);
         backdrop-filter: blur(2px);
      }

      .modal-content {
         background: linear-gradient(135deg, #fff 70%, #f3eaff 100%);
         margin: 7% auto;
         padding: 0;
         border: none;
         width: 370px;
         max-width: 95vw;
         border-radius: 1.5rem;
         box-shadow: 0 8px 40px #6339f055, 0 1.5px 0 #fff2;
         overflow: hidden;
         animation: chatbot-pop 0.5s;
      }

      @keyframes chatbot-pop {
         0% { transform: scale(0.8); opacity: 0; }
         100% { transform: scale(1); opacity: 1; }
      }

      .close {
         color: #6339f0;
         float: right;
         font-size: 2rem;
         font-weight: bold;
         border: none;
         background: transparent;
         padding: 0.5rem 1rem 0.5rem 0.5rem;
         cursor: pointer;
         transition: color 0.2s;
      }
      .close:hover {
         color: #32b1ff;
      }

      #bodybox {
         margin: 0;
         min-width: unset;
         max-width: unset;
         background: none;
         border: none;
         border-radius: 0;
         padding: 0 1.5rem 1.5rem 1.5rem;
      }

      #chatborder {
         border: none;
         background: #f6f9ff;
         padding: 1.2rem 0.5rem 1rem 0.5rem;
         border-radius: 1rem;
         height: 320px;
         overflow-y: auto;
         box-shadow: 0 2px 12px #6339f022;
         margin-bottom: 1rem;
      }

      #chatbox {
         width: 100%;
         font: 16px 'Montserrat', Arial, sans-serif;
         padding: 0.8rem 1rem;
         border-radius: 1.2rem;
         border: 2px solid #6339f0;
         margin-top: 0;
         outline: none;
         transition: border 0.2s;
         background: #f8f6ff;
         color: #2a1457;
      }
      #chatbox:focus {
         border: 2px solid #32b1ff;
      }

      .chatbot-btn {
         position: fixed;
         bottom: 30px;
         right: 30px;
         z-index: 1000;
         width: 68px;
         height: 68px;
         border-radius: 50%;
         border: none;
         background: linear-gradient(135deg, #6339f0 60%, #32b1ff 100%);
         box-shadow: 0 4px 24px #6339f055, 0 1.5px 0 #fff2;
         cursor: pointer;
         display: flex;
         justify-content: center;
         align-items: center;
         transition: transform 0.18s, box-shadow 0.18s;
         animation: chatbot-float 2.5s infinite ease-in-out;
      }
      @keyframes chatbot-float {
         0%, 100% { transform: translateY(0);}
         50% { transform: translateY(-8px);}
      }
      .chatbot-btn:hover {
         transform: scale(1.08);
         box-shadow: 0 8px 32px #32b1ff88;
      }

      .chatbot-btn img {
         width: 38px;
         height: 38px;
         filter: drop-shadow(0 2px 8px #fff8);
         transition: filter 0.2s;
      }

      #chatborder p {
         display: flex;
         align-items: flex-start;
         gap: 0.5rem;
         margin: 0 0 0.7rem 0;
         font-size: 1.05rem;
         line-height: 1.6;
         color: #2a1457;
         background: #e7e3ff;
         border-radius: 0.8rem;
         padding: 0.5rem 0.9rem;
         max-width: 85%;
         word-break: break-word;
      }
      #chatborder p.user {
         background: #d6f7ff;
         margin-left: auto;
         text-align: right;
         flex-direction: row-reverse;
      }
      #chatborder p.bot {
         background: #e7e3ff;
         margin-right: auto;
         text-align: left;
      }

      /* Loader Styles */
      .loader {
         display: inline-block;
         width: 22px;
         height: 22px;
         border: 3px solid #6339f0;
         border-radius: 50%;
         border-top: 3px solid #fff;
         animation: spin 0.8s linear infinite;
         vertical-align: middle;
         margin-left: 8px;
      }
      @keyframes spin {
         100% { transform: rotate(360deg);}
      }
   </style>
</head>

<body>
   <!--==================== HEADER ====================-->
   <header class="header" id="header">
      <nav class="nav container">
         <a href="index.html" class="nav--logo">
            <i class="ri-rocket-2-line"></i> AstroVision
         </a>

         <div class="nav--menu" id="nav-menu">
            <ul class="nav--list">
               <li class="nav--item"><a href="index.html" class="nav--link">Home</a></li>
               <li class="nav--item"><a href="explore.html" class="nav--link">Explore</a></li>
               <li class="nav--item"><a href="tutorial.html" class="nav--link">Tutorial</a></li>
               <li class="nav--item"><a href="analysis.html" class="nav--link">Analysis</a></li>
            </ul>
            <a href="model.html" class="nav--button">Model</a>
            <div class="nav--close" id="nav-close"><i class="ri-close-line"></i></div>
         </div>
         <div class="nav--toggle" id="nav-toggle"><i class="ri-apps-2-line"></i></div>
      </nav>
   </header>

   <!--==================== SELF LEARNING DASHBOARD ====================-->
   <div class="selflearn-dashboard">
     <aside class="selflearn-sidebar">
       <ul>
         <li class="active" data-lecture="0">Lecture 1: Introduction to Discovering Exoplanets</li>
         <li data-lecture="1">Lecture 2: Light Curve</li>
         <li data-lecture="2">Lecture 3: Transit "The Planet's Hidden Signature"</li>
         <li data-lecture="3">Lecture 4: Measuring Planet Properties from a Light Curve</li>
       </ul>
     </aside>

     <main class="selflearn-main">
       <section class="lecture-content" id="lecture-content"></section>
       <section class="lecture-quiz" id="lecture-quiz" style="display:none;"></section>
     </main>
   </div>

   <!--=============== CHATBOT BUTTON ===============-->
   <button id="chatBtn" class="chatbot-btn">
      <img src="assets/img/robot.png" alt="Chatbot Icon">
   </button>

   <!--=============== CHATBOT MODAL ===============-->
   <div id="chatModal" class="modal">
      <div class="modal-content">
         <span class="close">&times;</span>
         <div id="bodybox">
            <div id="chatborder"></div>
            <div style="display: flex; gap: 0.5rem;">
               <input type="text" id="chatbox" placeholder="Hello, type your question..." style="flex:1;" />
               <button id="sendBtn" style="background: linear-gradient(135deg,#6339f0 60%,#32b1ff 100%); border:none; border-radius:50%; width:44px; height:44px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                  <i class="ri-send-plane-2-fill" style="color:#fff; font-size:1.4rem;"></i>
               </button>
            </div>
         </div>
      </div>
   </div>

   <!--=============== GSAP ===============-->
   <script src="assets/js/gsap.min.js"></script>
   <!--=============== MAIN JS ===============-->
   <script src="assets/js/main.js"></script>
   <!--=============== SELF LEARN JS ===============-->
   <script src="assets/js/selflearn.js"></script>

   <!--=============== CHATBOT JS ===============-->
   <script type="module">
      import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

      const genAI = new GoogleGenerativeAI("AIzaSyA6IdlSTBoOKLRWtfmiFr7tUekDCaUbU5E");

      const modal = document.getElementById("chatModal");
      const btn = document.getElementById("chatBtn");
      const span = document.getElementsByClassName("close")[0];
      const chatBorder = document.getElementById("chatborder");
      const chatBox = document.getElementById("chatbox");
      const sendBtn = document.getElementById("sendBtn");

      const placeholders = [
         "Ask me about exoplanets...",
         "How do we detect planets?",
         "Type your astronomy question...",
         "ŸÖÿ´ÿßŸÑ: ŸÖÿß ŸáŸà Transitÿü",
         "How does light curve work?"
      ];
      btn.onclick = () => {
         modal.style.display = "block";
         chatBox.placeholder = placeholders[Math.floor(Math.random() * placeholders.length)];
      };
      span.onclick = () => modal.style.display = "none";
      window.onclick = e => { if (e.target == modal) modal.style.display = "none"; };

      chatBox.addEventListener("keypress", function(e) {
         if (e.key === "Enter") handleSend();
      });
      sendBtn.addEventListener("click", handleSend);

      async function handleSend() {
         if (chatBox.value.trim() !== "") {
            const userMsg = chatBox.value;
            appendMessage("üßë‚ÄçüöÄ You", userMsg);
            chatBox.value = "";

            appendMessage("ü§ñ AstroBot", "Thinking...");

            try {
               const model = genAI.getGenerativeModel({ model: "gemini-2.5-flash" });
               const result = await model.generateContent(userMsg);
               const botReply = result.response.text();
               updateLastBotMessage(botReply);
               // speak(botReply); // ÿ£ÿ≤ŸÑ ÿßŸÑÿ™ÿπŸÑŸäŸÇ ÿ•ÿ∞ÿß ÿ£ÿ±ÿØÿ™ ÿßŸÑŸÜÿ∑ŸÇ
            } catch (error) {
               updateLastBotMessage("‚ö†Ô∏è Error: " + error.message);
            }
         }
      }

      function appendMessage(sender, text) {
         const msg = document.createElement("p");
         if (sender.includes("You")) msg.classList.add("user");
         else msg.classList.add("bot");
         if (text === "Thinking...") {
            msg.innerHTML = `<b>${sender}:</b> <span class="loader"></span>`;
         } else {
            msg.innerHTML = `<b>${sender}:</b> ${text}`;
         }
         chatBorder.appendChild(msg);
         chatBorder.scrollTop = chatBorder.scrollHeight;
      }

      function updateLastBotMessage(text) {
         const lastMsg = chatBorder.lastChild;
         if (lastMsg && lastMsg.innerHTML.includes("Thinking...")) {
            lastMsg.innerHTML = `<b>ü§ñ AstroBot:</b> ${text}`;
         }
      }

      function speak(text) {
         if ('speechSynthesis' in window) {
            const utter = new SpeechSynthesisUtterance(text);
            utter.lang = 'en-US';
            speechSynthesis.speak(utter);
         }
      }
   </script>
</body>
</html>
